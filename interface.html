<html>
	<head>

	</head>
	<body>
		<script src="jquery-2.1.1.min.js"></script>   

		<script>

			// Map class definition
			function Map(mapHtml, wrapperMapHtml, gameInfoHtml){
				
				this.mapHtml = mapHtml;
				this.wrapperMapHtml = wrapperMapHtml;
				this.gameInfoHtml = gameInfoHtml;
				this.wrapperPadding = 30;
				this.squareHeight = 25;
				this.squareWidth = 30;
				this.squareSize = 20;
				this.candyList = new Array();
				this.player = null;
				this.otherPlayers = null;
				
				this.generateRandomCandy = function(){
					console.log("Generating random candy")
					this.candyList = new Array();
					for(var i=0;i<20;i++){
						var findGoodCoords = false;
						var candy = new Candy();	
						while(!findGoodCoords){
							var xRandom = Math.floor(Math.random() * (this.squareWidth - 0 + 1));
							var yRandom = Math.floor(Math.random() * (this.squareHeight - 0 + 1));
							candy.xCoord = xRandom;
							candy.yCoord = yRandom;								
							findGoodCoords = true;	
							for(var j=0;j<this.candyList.length;j++){
								if(candy.checkIfOverCandy(this.candyList[j])){
									findGoodCoords = false;
									break;
								}
							}						
						}										
						console.log("Adding a new candy");
						candy.id=i;
						this.mapHtml.append(candy.getHtml());
						this.candyList.push(candy);
					}
				};

				this.draw = function(){
					console.log("Drawing the map")

					this.wrapperMapHtml.css({"height": ((this.squareHeight*this.squareSize)+(2*this.wrapperPadding))+"px", "width": ((this.squareWidth*this.squareSize)+(2*this.wrapperPadding))+"px", "padding":this.wrapperPadding+"px"})

					this.mapHtml.css({"height": (this.squareHeight*this.squareSize)+"px", "width": (this.squareWidth*this.squareSize)+"px"})

					for(var i=0;i<this.candyList.length;i++){
						this.candyList[i].draw(this.squareSize);
					}

				}


				this.initPlayers = function(){
					this.player = new Player();
					this.mapHtml.append(this.player.getHtml());
					this.player.draw(this.squareSize);
				}

				this.eventMoveLeft = function(){
					console.log("Event move left");
					if(this.player.xCoord > 0){
						this.player.moveLeft();
						this.player.draw(this.squareSize);
						this.checkIfPlayerOverCandy();
					}
				}
				this.eventMoveUp = function(){
					console.log("Event move up");
					if(this.player.yCoord > 0){
						this.player.moveUp();
						this.player.draw(this.squareSize);
						this.checkIfPlayerOverCandy();
					}
				}
				this.eventMoveRight = function(){
					console.log("Event move right");
					if(this.player.xCoord < this.squareWidth){
						this.player.moveRight();
						this.player.draw(this.squareSize);
						this.checkIfPlayerOverCandy();
					}
				}
				this.eventMoveDown = function(){
					console.log("Event move down");
					if(this.player.yCoord < this.squareHeight){
						this.player.moveDown();
						this.player.draw(this.squareSize);
						this.checkIfPlayerOverCandy();
					}
				}

				this.checkIfPlayerOverCandy = function(){
					console.log("Check if player over candy");
					for(var i=0;i<this.candyList.length;i++){
						if(this.candyList[i].state){
							if((this.player.xCoord == this.candyList[i].xCoord) && (this.player.yCoord == this.candyList[i].yCoord)){
								this.candyList[i].state=false;
								this.candyList[i].draw();
								this.player.addPoint();	
								this.displayScore();							
								break;
							}
						}
					}
				}

				this.displayScore = function(){
					this.gameInfoHtml.html("You ate "+this.player.points+" candy");
				}

			}

			// Candy class definition 
			function Candy(){
				this.id = null;
				this.xCoord = null;
				this.yCoord = null;
				this.state = true;
				this.radius = 15;

				/*
				* Return true if candy is over anothercandy
				*/
				this.checkIfOverCandy = function(anotherCandy){
					return !(this.xCoord!=anotherCandy.xCoord && this.yCoord!=anotherCandy.yCoord);
				}

				this.getHtml = function(){
					return '<div class="Candy" id="'+this.id+'-candy'+'">&nbsp;</div>';
				}

				this.draw = function(squareSize){
					console.log("Drawing a candy");
					if($("#"+this.id+"-candy")){
						if(this.state){
							$("#"+this.id+"-candy").css({"top": ((this.yCoord*squareSize)-this.radius)+"px", "left": ((this.xCoord*squareSize)-this.radius)+"px", "height": ((this.radius*2)+1)+"px", "width": ((this.radius*2)+1)+"px"});
						}else{
							$("#"+this.id+"-candy").fadeOut( "slow", function() {});
						}
					}
				}
			}

			// Interface class
			function Game(){
				this.map = null;				
				this.initMap = function(mapHtml, wrapperMapHtml, gameInfoHtml){
					this.map = new Map(mapHtml, wrapperMapHtml, gameInfoHtml);
					this.map.generateRandomCandy();
					this.map.initPlayers();
					this.map.draw();
					this.map.displayScore();
				}				
			}

			// Player class
			function Player(){
				this.name="test";
				this.xCoord = 2;
				this.yCoord = 2;
				this.radius = 20;
				this.direction = "right";
				this.stateMouth = true;
				this.points = 0;

				this.addPoint = function(){
					this.points++;					
				}

				this.moveLeft = function(distance){
					this.xCoord--;
					this.direction = "left";
					this.stateMouth = !this.stateMouth;
				}
				this.moveUp = function(){
					this.yCoord--;					
					this.direction = "up";					
					this.stateMouth = !this.stateMouth;
				}
				this.moveRight = function(){
					this.xCoord++;
					this.direction = "right";					
					this.stateMouth = !this.stateMouth;
				}
				this.moveDown = function(){
					this.yCoord++;
					this.direction = "down";
					this.stateMouth = !this.stateMouth;
				}

				this.getHtml = function(){
					return '<div class="Player pacman" id="'+this.name+'-player'+'">&nbsp;</div>';
				}

				this.draw = function(squareSize){
					console.log("Drawing a player");
					if($("#"+this.name+"-player")){
						$("#"+this.name+"-player").css({"top": ((this.yCoord*squareSize)-this.radius)+"px", "left": ((this.xCoord*squareSize)-this.radius)+"px"});
						$("#"+this.name+"-player").removeClass("pacman-left");
						$("#"+this.name+"-player").removeClass("pacman-up");
						$("#"+this.name+"-player").removeClass("pacman-right");
						$("#"+this.name+"-player").removeClass("pacman-down");
						$("#"+this.name+"-player").addClass("pacman-"+this.direction);

						$("#"+this.name+"-player").removeClass("pacman-mouth-open");
						$("#"+this.name+"-player").removeClass("pacman-mouth-close");
						$("#"+this.name+"-player").addClass("pacman-mouth-"+this.stateMouthText());
					}
				}

				this.stateMouthText = function(){
					if(this.stateMouth){
						return "open";
					}else{
						return "close";
					}
				}
			}

			// Main program
			var game =null;
			$(document).ready(function(){
				game = new Game();
				game.initMap($("#GameMap"), $("#MapWrapper"), $("#GameInfo"));

				$(document).keydown(function(e) {
				    switch(e.which) {
				        case 37: // left
				        	game.map.eventMoveLeft();break;
				        case 38: // up
				        	game.map.eventMoveUp();break;
				        case 39: // right
				        	game.map.eventMoveRight();break;
				        case 40: // down
				        	game.map.eventMoveDown();break;
				        default: return;
				    }
				    e.preventDefault();
				});
			});

		</script>

		<div id="GameWrapper">
			<div id="MapWrapper">
				<div id="GameMap"></div>
			</div>
			<div id="GameInfo"></div>
		</div>  

		<style>
			body{
				text-align: center;
				margin: 0;
				padding: 0;
				background-color: #333333;
				font-family: arial;
				overflow: hidden;
			}

			#GameWrapper{
				display: inline-block;
				height: 920px;
				min-width: 1px;	
				margin: 40px;		
			}

			#MapWrapper{
				position: relative;
				display: block;			
				background-color: #222222;	
				border: 3px solid white;		
			}	

			#GameMap{
				position: relative;
				display: block;			
				background-color: #222222;	
			}	

			#GameInfo{
				display: block;
				height: 100px;
				min-width: 1px;
				color: #FFFFFF;
				font-size: 60px;
				font-weight: bold;
				text-align: center;
				margin-top: 20px;
			}	

			.Candy{
    			position: absolute;  
				background-color: red;				
    			border-radius: 50%;			
			}

			.Player{
    			position: absolute;  
			}

			.pacman{				
			  	width: 0px;
			  	height: 0px;
				border-top-left-radius: 20px;
				border-top-right-radius: 20px;
				border-bottom-left-radius: 20px;
				border-bottom-right-radius: 20px;				
				border: 20px solid yellow;
			}

			.pacman-mouth-open{
				background-color: transparent;
			}

			.pacman-mouth-close{
				background-color: yellow;
			}

			.pacman-left {
				border-left: 20px solid transparent;
			}

			.pacman-up {
				border-top: 20px solid transparent;
			}

			.pacman-right {
				border-right: 20px solid transparent;
			}

			.pacman-down {
				border-bottom: 20px solid transparent;
			}

		</style>		   
	</body>
</html>