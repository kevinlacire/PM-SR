<html>
	<head>

	</head>
	<body>
		<script src="jquery-2.1.1.min.js"></script>
		<script src="./class/Render.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<link rel="stylesheet" type="text/css" href="./css/style.css"/>
		<script>

			var socket 	= io.connect('http://localhost:8080', {
				    reconnect: false
				}),
				render	= new Render(),
				map		= null,
				aboutMe	= null;

			socket.emit('connection', '');

			console.log(socket);

			socket.on('gameConfiguration', function(datas){
				map 	= datas;
				render 	= new Render(map, $('#GameMap'), $('GameWrapper'));
				render.printMap($('MapWrapper'), $('#GameMap'), map.squareHeight, map.squareWidth, map.squareSize, map.wrapperPadding);
				$('.Candy').remove();
				for(var i=0 ; i<map.candies.length ; i++){
					render.editCandy(map.candies[i], map, $('#GameMap'));
				}
				$('.Player').remove();
				for(var i=0 ; i<map.players.length ; i++){
					render.editPlayerPosition(map.players[i], map, $('#GameMap'));
				}
			});

			socket.on('sendYourName', function(){
				$('#NameForm').submit(function(event){
					event.preventDefault();
					socket.emit('playerName', $('input[type=text]').val());
				});
			});

			socket.on('candiesPositions', function(datas){
				$('.Candy').remove();
				for(var i=0 ; i<datas.length ; i++){
					render.editCandy(datas[i], map, $('#GameMap'));
				}
			});

			socket.on('aboutMe', function(datas) {
				if (aboutMe === null) {
					aboutMe = datas;
				}
				render.editPlayerPosition(aboutMe, map, $('#GameMap'));
				$(document).ready(function(){
					$(document).keydown(function(e) {
						switch(e.which) {
							case 37: // left
								aboutMe.direction = 'left';
								socket.emit('playerMove', aboutMe);break;
							case 38: // up
								aboutMe.direction = 'up';
								socket.emit('playerMove', aboutMe);break;
							case 39: // right
								aboutMe.direction = 'right';
								socket.emit('playerMove', aboutMe);break;
							case 40: // down
								aboutMe.direction = 'down';
								socket.emit('playerMove', aboutMe);break;
							default: return;
						}
						e.preventDefault();
					});
				});
			});

			socket.on('newPlayer', function(datas){
				render.editPlayerPosition(datas, map, $('#GameMap'));
			});

			socket.on('playerMove', function(datas){
				render.editPlayerPosition(datas, map, $('#GameMap'));
			});

			socket.on('candyCaught', function(datas){
				console.info('candyCaught', datas);
				render.editCandy(datas, map, $('GameMap'));
			});

			socket.on('playersPoints', function(datas){
				console.info('players points', datas);
			});

			socket.on('gameFull', function(){
				alert("La partie est complÃ¨te");
			});

			socket.on('gameOver', function(datas){
				console.error('Game Over', datas);
			});

			socket.on('tenSecondsCountdown', function(time){
				console.info('wait for 10sec');
				startCountDown("Waiting for players", time);
			});

			socket.on('candiesPosition', function(datas){
				$('.Candy').remove();
				for(var i=0 ; i<map.candies.length ; i++){
					render.editCandy(map.candies[i], map, $('#GameMap'));
				}
			});

			socket.on('readySteadyGo', function(time){
				console.info('start in 3..2..1');
				startCountDown("Game start in", time);
			});

		</script>

		<div id="MenuWrapper">
			<form id="NameForm" action="#">
				<br/>
				<span style="color:white;font-size:18px;">Enter your name</span>
				<br/><br/>
				<input type="text" class="Input"/>
				<br/>
				<input type="submit" class="Button"/>
				<br/>
			</form>

			<div id="GameInfo"></div>
		</div>

		<div id="GameWrapper">
			<div id="MapWrapper">
				<div id="GameMap"></div>
			</div>
			<div id="CountDownWrapper">
				<div id="CountDownMessage"></div>
				<div id="CountDownValue"></div>
			</div>
		</div>

		<script>
			var interval = null;

			function startCountDown(message, time){
				if(interval != null){
					clearInterval(interval);
				}
				$("#CountDownWrapper").show();
				$("#CountDownMessage").html(message);
				var countDown = time;
				interval = setInterval(function() {   
		            if(countDown<0){
		            	clearInterval(interval);
		            	$("#CountDownWrapper").hide();
						$("#CountDownMessage").html(""); 
				        $("#CountDownValue").html("");
		            }else{
			            $("#CountDownValue").html(countDown);
						countDown--;
		            }
		         }, 1000);
			}



			

		</script>
	</body>
</html>
